--Create Schema

Create Table dim_date (
   date_id int identity(1,1) primary key,
   Full_Date Date,
   Year int,
   Month int,
   Month_Name varchar(50),
   Quarter int,
   Day int,
   Week int
   )

--Dim Location
Create Table dim_location (
location_id int identity(1,1) primary key,
State Varchar (100),
City Varchar(100),
Location Varchar(200)
);

--dim Restaurant
Create Table dim_restaurant (
restaurant_id int identity(1,1) primary key,
Restaurant_Name varchar(200)
);

--dim Category
Create Table dim_category(
category_id int identity(1,1) primary key,
category varchar(200)
);

--dim Dish
Create Table dim_dish(
dish_id int identity(1,1) primary key,
Dish_Name varchar(200)
);

--Fact Table
create table fact_swiggy_orders(
order_id int identity(1,1) primary key,

date_id int,
price_inr decimal(10,2),
Rating decimal(4,2),
Rating_Count int,

location_id int,
restaurant_id int,
category_id int,
dish_id int,

Foreign key (date_id) references dim_date(date_id),
Foreign key (location_id) references dim_location(location_id),
Foreign key (restaurant_id) references dim_restaurant(restaurant_id),
Foreign key (category_id) references dim_category(category_id),
Foreign key (dish_id) references dim_dish(dish_id)
);

select * from fact_swiggy_orders;


--Insert Data into Tables
--dim date

insert into dim_date(Full_Date,Year, Month, Month_Name, Quarter, Day, Week)
select distinct
order_date,
year(order_date),
month(order_date),
datename(month, order_date),
datepart(quarter,order_date),
day(order_date),
datepart(week,order_date)
from swiggy_data
where order_date is not null;


select * from dim_restaurant

--dim location
insert into dim_location(State,City,location)
select distinct
state,
city,
location
from swiggy_data;

-- dim_restaurant
insert into dim_restaurant (Restaurant_Name)
select distinct
Restaurant_Name
from swiggy_data;


select * from dim_dish

-- dim category
INSERT INTO fact_swiggy_orders (
    date_id,
    price_inr,
    Rating,
    Rating_Count,
    location_id,
    restaurant_id,
    category_id,
    dish_id
)
SELECT
    dd.date_id,
    s.price_inr,
    s.Rating,
    s.Rating_Count,
    dl.location_id,
    dr.restaurant_id,
    dc.category_id,
    dsh.dish_id
FROM swiggy_data s
JOIN dim_date dd
    ON dd.Full_Date = s.Order_Date
JOIN dim_location dl
    ON dl.State = s.State
    AND dl.City = s.City
    AND dl.Location = s.Location
JOIN dim_restaurant dr
    ON dr.Restaurant_Name = s.Restaurant_Name
JOIN dim_category dc
    ON dc.Category = s.Category
JOIN dim_dish dsh
    ON dsh.Dish_Name = s.Dish_Name;

    select * from fact_swiggy_orders f
    join dim_date d on f.date_id = d.date_id
    join dim_location l on f.location_id = l.location_id
    join dim_restaurant r on f.restaurant_id = r.restaurant_id
    join dim_category c on f.category_id = c.category_id
    join dim_dish di on f.dish_id = di.dish_id;
